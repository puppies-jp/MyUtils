# Docker

\[TODO]:`compose`ã¨ã‹ã¨æ•´ç†ãŒç…©é›‘ã«ãªã£ã¦ãã¦ã‚‹ã‹ã‚‰ãã®ã†ã¡æ•´ç†ã™ã‚‹ï¼ï¼

- å¤§ã¾ã‹ãªæµã‚Œã‚’ä»¥ä¸‹ã«ã¾ã¨ã‚ã‚‹

  1. Docker Hub ã‹ã‚‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ¤œç´¢ï¼å–å¾—ã™ã‚‹ã€‚(search/pull)
  1. [ã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã‚’ç”Ÿæˆã—ã¦èµ·å‹•(run)](#run)
  1. [ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ (exec)](#exec)
  1. [ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢ (start/stop)](#start_stop)
  1. [ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸åŒ– (commit)](#commit)
  1. [ã„ã‚‰ãªããªã£ãŸã‚‰ã‚¤ãƒ¡ãƒ¼ã‚¸/ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ (rmi/rm)](#rm)
  1. [ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›/èª­ã¿è¾¼ã¿ã‚’è¡Œã†](#save_load)

- ãã®ä»–ã‚ˆãåˆ©ç”¨ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
  - å–å¾—æ¸ˆã¿ã‚¤ãƒ¡ãƒ¼ã‚¸ä¸€è¦§ (images)
  - å®Ÿè¡Œä¸­ã‚³ãƒ³ãƒ†ãƒŠä¸€è¦§ (ps)
  - åœæ­¢ä¸­ã‚‚å«ã‚ãŸå…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒŠä¸€è¦§ (ps -a)
  - åœæ­¢ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹• (start)
  - ãƒ›ã‚¹ãƒˆã¨ã‚³ãƒ³ãƒ†ãƒŠé–“ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼ (cp)

- ä»–
  - [GPU(nvidiaã ã‘ã§ã¯ãªã„)ã‚’ä½¿ã†](#gpu)
  - [Dockerfileã‚’ä½œæˆã™ã‚‹](WhatDockerfile)
  - [ã‚³ãƒ³ãƒ†ãƒŠé–“ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’è¨­å®šã™ã‚‹](dockerNetwork)
  - [ãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹/DockerCompose](DockerCompose)
  - [Docker in Docker/Docker outside of Dockerã«ã¤ã„ã¦](InOutSizeOf)
    - Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã•ã‚‰ã«Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’å‹•ã‹ã™(Docker in Docker)
    - Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰DockerHostã®Dockerã‚’æ“ä½œã™ã‚‹

---

## <a name='gpu'>Dockerã§ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚«ãƒ¼ãƒ‰å‘¨ã‚Šã®æ©Ÿèƒ½ã‚’ä½¿ã†</a>

- `CentOS 7.xã®å ´åˆã€/dev/dri/cardX`ãªã©ã®ãƒ‡ãƒã‚¤ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’dockerä¸Šã§å…±æœ‰ã—ã‚³ãƒ³ãƒ†ãƒŠã¨å…±æœ‰ã—ã¦ä½¿ç”¨ã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢

```sh
# docker run \
...
--device=/dev/dri:/dev/dri \  â†æç”»ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’å…±æœ‰
--device=/dev/input:/dev/input \ã€€â†ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’å…±æœ‰
...
ubuntu:mygame01 /bin/bash
```

ä»¥ä¸‹ã€å‚è€ƒãƒªãƒ³ã‚¯

- [Dockerã§3Dã‚²ãƒ¼ãƒ ã‚’å‹•ã‹ã™â€•â€•æ§‹ç¯‰ç·¨(IT-media)](https://www.itmedia.co.jp/enterprise/articles/1604/27/news001_3.html)

 ---

## Docker ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚³ãƒãƒ³ãƒ‰

ãŸã¾ã«ã‚„ã‚‹ã¨å¿˜ã‚Œãã†ãªã®ã§ã€ãƒ¡ãƒ¢ã‚’æ®‹ã—ã¦ãŠã

- mac ã®å ´åˆ

```sh
brew upgrade --cask docker
```

---

## Ubuntuãªã©ã§Dockerã‚³ãƒãƒ³ãƒ‰ã‚’sudoãªã—ã®è¨­å®šã«ã™ã‚‹

```sh
# ğŸŒŸdocker ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã—ãŸã„ãƒ¦ãƒ¼ã‚¶ãŒã„ãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹
getent group docker

# ğŸŒŸ dockerã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ã‚’è¿½åŠ ã™ã‚‹
sudo gpasswd -a <ãƒ¦ãƒ¼ã‚¶å> docker
```

---

## Docker Hub ã‹ã‚‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ¤œç´¢ï¼å–å¾—ã™ã‚‹

- æ¤œç´¢

```sh
$ docker search [imageå]

# ä¾‹
$ docker search ubuntsu
NAME                         DESCRIPTION        STARS     OFFICIAL   AUTOMATED
ubuntsu/ubuntu                                  0
takuyatomioka/ubuntsu-test   test               0
nomsho/gcp                   gcloud ubuntsu     0
nomsho/java                  git-java ubuntsu   0
```

- å–å¾—

```docker
$ docker pull [imageå]

# ä¾‹
$ docker pull ubuntsu/ubuntu
```

- å–å¾—çµæœã‚’ç¢ºèªã™ã‚‹

```sh
$ docker images
REPOSITORY               TAG       IMAGE ID       CREATED             SIZE
docker101tutorial        latest    452eceecfe4f   About an hour ago   28.5MB
alpine/git               latest    c6b70534b534   3 weeks ago         27.4MB
uphy/ubuntu-desktop-jp   latest    3ba68e262397   4 weeks ago         1.34GB
uphy/ubuntu-desktop-jp   18.04     2f92249dc622   3 years ago         908MB
```

## <a name="run">ã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã‚’ç”Ÿæˆã—ã¦èµ·å‹•(run)</a>

- `ã‚³ãƒ³ãƒ†ãƒŠã‚’ç”Ÿæˆã—ã¦èµ·å‹•` (ã‚ãã¾ã§ç”Ÿæˆã—ã¦ã‹ã‚‰èµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ã“ã¨)

```sh
# ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§èµ·å‹•ã™ã‚‹ã“ã¨ã§ $pwdã¨desktopã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±æœ‰ã§ãã‚‹
docker run -d -p 8080:8080 -v $(pwd):/root/Desktop --name ubuntuCont uphy/ubuntu-desktop-jp

# ubuntsuã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã™ã‚‹
docker run -it -d \
--name <ã‚³ãƒ³ãƒ†ãƒŠå> \
-v ~/Docker/Ubuntsu:/root/ \
--privileged \
ubuntu:latest /bin/bash
```

- `-d` : ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œ
  ä»˜ã‘å¿˜ã‚Œã¦å®Ÿè¡Œã™ã‚‹ã¨ã‚³ãƒãƒ³ãƒ‰å…¥åŠ›ãŒè¡Œãˆãªããªã‚Šã¾ã™ã€‚ãã®å ´åˆã¯æ…Œã¦ãšã«åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’ç«‹ã¡ä¸Šã’ã¦ä½œæ¥­ or åœæ­¢ã‹ã‚‰ã®å†èµ·å‹•ã‚’è¡Œã†

- `-p 8080(hostå´):8080(ã‚³ãƒ³ãƒ†ãƒŠå´)` : ãƒ›ã‚¹ãƒˆå´ã® 8080 ç•ªãƒãƒ¼ãƒˆã‚’ã‚³ãƒ³ãƒ†ãƒŠå´ã® 8080 ç•ªãƒãƒ¼ãƒˆã«è»¢é€ã™ã‚‹ã‚ˆã†ã«æŒ‡å®š(GUI ãŒå‹•ãã®ã§ã‚ã‚Œã°ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ GUI ã«å…¥ã‚Œã‚‹ã¯ãš)

  > <http://localhost:8080/>

- `-v $(pwd):/root/Desktop`
  ãƒ›ã‚¹ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª(`$(pwd)`)ã‚’ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª(`/root/Desktop`)ã¨ã—ã¦ãƒã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚(`ãƒ›ã‚¹ãƒˆå´ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚‚çµ¶å¯¾ãƒ‘ã‚¹ã§æŒ‡å®šã™ã‚‹ å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`)
  `-v` ã§ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã‚‚ã®ã‚’ ãƒœãƒªãƒ¥ãƒ¼ãƒ  ã¨è¨€ã„ã¾ã™ã€‚v ã¯ volume ã®é ­æ–‡å­—ã§ã™ã€‚

- `--name ubuntuCont`
  ç”Ÿæˆã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã«åå‰ã‚’ã¤ã‘ã¾ã™ã€‚åå‰ã‚’ã¤ã‘ãšã«ã‚³ãƒ³ãƒ†ãƒŠ ID ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€æŒ‡å®šã™ã‚‹ã®ãŒé¢å€’ãªã®ã§åå‰ã‚’ã¤ã‘ãŸæ–¹ãŒä½œæ¥­ã—ã‚„ã™ã„ã§ã™ã€‚

- `--privileged`
  Dockerã‚³ãƒ³ãƒ†ãƒŠä¸Šã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`systemctl`ãŒä½¿ãˆãªã„ã€ãã“ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’
  `ç‰¹æ¨©ãƒ¢ãƒ¼ãƒ‰(privileged)`ã«ã™ã‚‹ã“ã¨ã§ã€`/sbin/init`ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚
  Docker Composeã®å ´åˆã¯ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®šã«ä»¥ä¸‹ã‚’è¿½åŠ ã™ã‚‹ã ã‘
  > privileged: true

---

## <a name="exec">ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ (exec)</a>

```sh
docker exec -it [ã‚³ãƒ³ãƒ†ãƒŠå] [ã‚³ãƒãƒ³ãƒ‰]

# ä¾‹
docker exec -it ubuntuCont /bin/bash
docker exec -it ubuntuCont pwd
```

## <a name="start_stop">ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•/åœæ­¢ã™ã‚‹</a>

image ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ãŸå ´åˆã¯ã“ã“ã§èµ·å‹•ã€åœæ­¢ã‚’è¡Œã†

```sh
docker start [ã‚³ãƒ³ãƒ†ãƒŠå]
docker stop [ã‚³ãƒ³ãƒ†ãƒŠå]

# ä¾‹
docker start ubuntuCont
docker stop ubuntuCont
```

## <a name="commit">ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸åŒ– (commit)</a>

```sh
# ã‚¤ãƒ¡ãƒ¼ã‚¸å‘½åè¦å‰‡
#<Docker Hubã®ãƒ¦ãƒ¼ã‚¶å>/ã‚¤ãƒ¡ãƒ¼ã‚¸å:[ã‚¿ã‚°å]

docker commit [ã‚³ãƒ³ãƒ†ãƒŠå] [ã‚¤ãƒ¡ãƒ¼ã‚¸å]
docker commit  ubuntuCont local/ubuntu
```

## <a name="rm">ã„ã‚‰ãªããªã£ãŸã‚‰ã‚¤ãƒ¡ãƒ¼ã‚¸/ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ (rmi/rm)</a>

```sh
# ã‚¤ãƒ¡ãƒ¼ã‚¸å‰Šé™¤
docker rmi [ã‚¤ãƒ¡ãƒ¼ã‚¸å]
# ã‚³ãƒ³ãƒ†ãƒŠå‰Šé™¤
docker rm [ã‚³ãƒ³ãƒ†ãƒŠå]

# ä¾‹
docker rmi loc/ubuntu
docker rm loc/ubuntu
```

## <a name="save_load">ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›/èª­ã¿è¾¼ã¿ã‚’è¡Œã†</a>

```sh
# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ã™ã‚‹
docker save [ã‚¤ãƒ¡ãƒ¼ã‚¸å] -o [ãƒ•ã‚¡ã‚¤ãƒ«å].tar
# saveã§å‡ºåŠ›ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚€
docker load -i [ãƒ•ã‚¡ã‚¤ãƒ«å].tar
```
